<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>router.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="rzl.Modal.html">Modal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Modal.html#build">build</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Modal.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Modal.html#hide">hide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Modal.html#show">show</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="rzl.Router.html">Router</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Router.html#_loadLayout">_loadLayout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Router.html#_parsePath">_parsePath</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Router.html#_render">_render</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Router.html#getHashPath">getHashPath</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Router.html#navigate">navigate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.Router.html#setHashPath">setHashPath</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="rzl.UI.html">UI</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.UI.html#build">build</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.UI.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.UI.html#hide">hide</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.UI.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.UI.html#show">show</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="rzl.UIComponent.html">UIComponent</a></span></li><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="rzl.html">rzl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.addDiv">addDiv</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.addElement">addElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.applyFunc">applyFunc</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.capitalise">capitalise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.destroyChild">destroyChild</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.destroyChildDivs">destroyChildDivs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.destroyChildren">destroyChildren</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.destroyElement">destroyElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.eventAdd">eventAdd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.eventAddById">eventAddById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.eventDel">eventDel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.eventPrevent">eventPrevent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.findChild">findChild</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.getFormFields">getFormFields</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.isIterable">isIterable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.isString">isString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.largestOf">largestOf</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.parseFunc">parseFunc</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.randomArrayItem">randomArrayItem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.rng0to">rng0to</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.rng1to">rng1to</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.setSelOpts">setSelOpts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.setStyle">setStyle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="rzl.html#.undef">undef</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">router.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Contains routing classes.
 * @author Elliot Thomas
 */
if (typeof rzl === "undefined") throw new Error("Requires rzl/core");

/** Router class. */
rzl.Router = class Router {
  /**
   * Construct a Router.
   * @param {Object} [args={}] - Construction arguments.
   * @param {Map|Iterable[]} [args.hooks]
   * [See props]{@link rzl.Router#props}
   * @param {Map|Iterable[]} [args.routes]
   * [See props]{@link rzl.Router#props}
   * @param {String} [args.name=""]
   * [See props]{@link rzl.Router#props}
   * @param {Element} [args.outlet=document.body]
   * [See props]{@link rzl.Router#props}
   * @param {Boolean} [args.useHash=true]
   * [See props]{@link rzl.Router#props}
   * @param {Boolean} [args.maxHistory=10]
   * [See props]{@link rzl.Router#props}
   */
  constructor(args = {}) {
    /**
     * The properties of this Router.
     * @summary Router props.
     * @member {Map} rzl.Router#props
     * @private
     */
    this.props = new Map([
      ["hooks", new Map(args.hooks || [])],
      ["routes", args.routes || []],
      ["name", args.name || ""],
      ["outlet", args.outlet || document.body],
      ["useHash", args.useHash || true],
      ["maxHistory", args.maxHistory || 10]
    ]);

    /**
     * The current state of this Router.
     * @summary Router state.
     * @member {Map} rzl.Router#state
     */
    this.state = new Map([
      ["history", []],
      ["path", this.getHashPath()]
    ]);

    // Setup hash routing
    if (args.useHash) window.onhashchange = () => this._render();

    // navigate to current route
    this.navigate(this.getHashPath());
  }

  /**
   * The hooks activated by this Router.
   * @summary Router hooks.
   * @type {Map|Iterable[]}
   */
  get hooks() {
    return this.props.get("hooks");
  }
  set hooks(hooks) {
    return this.props.set("hooks", hooks).get("hooks");
  }

  /**
   * The routes handled by this Router.
   * @summary Router routes.
   * @type {Array}
   */
  get routes() {
    return this.props.get("routes");
  }
  set routes(routes) {
    return this.props.set("routes", routes).get("routes");
  }

  /**
   * The name for this Router.
   * @summary Router name.
   * @type {String}
   */
  get name() {
    return this.props.get("name");
  }
  set name(name) {
    return this.props.set("name", name).get("name");
  }

  /**
   * The DOM element this Router outputs to.
   * @summary Router outlet.
   * @type {HTMLElement}
   */
  get outlet() {
    return this.props.get("outlet");
  }
  set outlet(outlet) {
    return this.props.set("outlet", outlet).get("outlet");
  }

  /**
   * Current path of this router.
   * @summary Current path.
   * @type {String}
   */
  get path() {
    return this.state.get("path");
  }
  set path(path) {
    return this.state.set("path", path).get("path");
  }

  /**
   * History of navigation in this Router.
   * @summary Router history.
   * @type {Array}
   */
  get history() {
    return this.state.get("history");
  }
  set history(history) {
    return this.state.set("history", history).get("history");
  }

  /**
   * Get the current hash and tidy it up, returning the path.
   * @summary Get the hash path.
   */
  getHashPath() {
    return location.hash.replace(/^#?\/?/, "");
  }

  /**
   * Format the given path and set the hash.
   * @summary Set the hash path.
   * @param {String} path The path to set.
   */
  setHashPath(path) {
    return (location.hash = path.replace(/^#?\/?/, "#/"));
  }

  /**
   * Validate the given route and update the hash to trigger render.
   * @summary Navigate to route.
   * @param {String} path The path to navigate to.
   */
  navigate(path = "") {
    this.props.get("useHash") ? this.setHashPath(path) : this._render(path);
    return true;
  }

  /**
   * Parse the given path and return the matching route.
   * @summary Parse path and return matching route.
   * @param {String} path The path to parse.
   */
  async _parsePath(path) {
    return new Promise((resolve, reject) => {
      // iteratively check for given path
      function findRoute(routes, path) {
        const prefix = (route, path) => path.startsWith(route.path),
          full = (route, path) => path === route.path;

        // check each route against the new path
        for (let r of routes) {
          // select matcher function in order of custom, fullPath and prefixPath
          const matcher = r.matcher || r.pathMatch === "full" ? full : prefix;

          // not a match, continue to next route
          if (!matcher(r, path)) continue;

          // route matches, check children or return result if no children
          const slice = path.slice(r.path.length);
          const child = r.children &amp;&amp; findRoute(r.children, slice);
          return child || r;
        }
      }

      // search for match in router routes
      const rt = findRoute(this.routes, path);

      // settle the promise
      rt ? resolve(rt) : reject();
    });
  }

  /**
   * Load the layout for the given route, either locally or over http.
   * @summary Load the route layout.
   * @param {Object} route The route to use.
   */
  async _loadLayout(route = {}) {
    return new Promise((resolve, reject) => {
      if (!rzl.isString(route.layout)) resolve(route.layout);
      else resolve(fetch(route.layout).then(l => l.json()));
    });
  }

  /**
   * Get the route from the path and render the layout in the router outlet.
   * @summary Render route layout.
   */
  async _render(path = this.getHashPath()) {
    // parse route from path
    const route = await this._parsePath(path);

    // load layout
    const layout = await this._loadLayout(route);

    // activate prwe-navigation hooks
    if (this.hooks.has("willNavigate")) this.hooks.get("willNavigate")();

    // display new layout
    new rzl.UI(layout, { pnode: this.outlet });

    if (this.hooks.has("didNavigate")) this.hooks.get("didNavigate")();

    // update router history
    const count = this.history.push(this.path);
    while (count > this.props.get("maxHistory")) this.history.shift();
    this.path = path;
  }
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Feb 06 2020 13:40:07 GMT+0000 (Greenwich Mean Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
